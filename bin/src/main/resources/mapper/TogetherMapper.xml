<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.TogetherDao">
 
 	
 	<select id="listTogether" resultType="com.example.demo.vo.TogetherVo" parameterType="com.example.demo.vo.SearchCriteria">
 		select t_num,
 		t_thumbnail,
 		t_title,
 		t_intro,
 		user_id,
 		t_size,
 		t_attendee_cnt,
 		t_date,
 		t_place,
 		t_hit
 		from
 		(
 		select t_num,
 		t_thumbnail,
 		t_title,
 		t_intro,
 		user_id,
 		t_size,
 		t_attendee_cnt,
 		t_date,t_place,
 		t_hit,
 		row_number() over(order by t_num desc) as rNum
 		from together
 		where 1=1
 		<include refid="search"></include>
 		)MP
		where rNum between #{rowStart} and #{rowEnd}
		order by t_num desc
 	</select>
 	
<!--  	<select id="listTogether" resultType="com.example.demo.vo.TogetherVo" parameterType="com.example.demo.vo.Criteria"> -->
<!--  		select t_num, -->
<!--  		t_thumbnail, -->
<!--  		t_title, -->
<!--  		t_intro, -->
<!--  		user_id, -->
<!--  		t_size, -->
<!--  		t_attendee_cnt, -->
<!--  		t_date, -->
<!--  		t_place, -->
<!--  		t_hit -->
<!--  		from -->
<!--  		( -->
<!--  		select t_num, -->
<!--  		t_thumbnail, -->
<!--  		t_title, -->
<!--  		t_intro, -->
<!--  		user_id, -->
<!--  		t_size, -->
<!--  		t_attendee_cnt, -->
<!--  		t_date,t_place, -->
<!--  		t_hit, -->
<!--  		row_number() over(order by t_num desc) as rNum -->
<!--  		from together )MP -->
<!-- 		where rNum between #{rowStart} and #{rowEnd} -->
<!-- 		order by t_num desc -->
<!--  	</select> -->
 	
 	<select id="listCount" parameterType="com.example.demo.vo.SearchCriteria" resultType="int">
		SELECT COUNT(t_num)
		 FROM together
		 WHERE 1=1 
		 <include refid="search"></include>
		 and t_num > 0
	</select>
	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 't'.toString()">AND t_title LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'd'.toString()">AND t_detail LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'w'.toString()">AND user_id LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'p'.toString()">AND t_date LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'td'.toString()">AND (t_title LIKE '%' || #{keyword} || '%') or (t_detail LIKE '%' || #{keyword} || '%')</if>
		</if>
	</sql>
	
<!-- 	<select id="listCount" resultType="int"> -->
<!-- 		<![CDATA[ -->
<!-- 			SELECT COUNT(t_num) -->
<!-- 			  FROM together -->
<!-- 			WHERE t_num > 0 -->
<!-- 		]]> -->
<!-- 	</select> -->

	<insert id="writeTogether">
		insert into together(t_num,t_title,t_intro,t_detail,t_open_date,t_thumbnail,t_place,t_date,t_size,t_attendee_cnt,t_fname,user_id,t_hit)
		values (seq_together.nextval,#{t_title},#{t_intro},#{t_detail},sysdate,'w.jpg',#{t_place},#{t_date},10,5,'fname.jpg','wonwoo',0)
	</insert>
	
<!-- 	<select id="listTogether" resultType="com.example.demo.vo.TogetherVo"> -->
<!-- 		select * from together order by t_num desc -->
<!-- 	</select> -->
	
	<select id="detailTogether" parameterType="int" resultType="com.example.demo.vo.TogetherVo">
		select * from together where t_num = #{t_num}
	</select>
	
	<update id="updateTogether" parameterType="com.example.demo.vo.TogetherVo">
		update together set t_thumbnail=#{t_thumbnail,jdbcType = VARCHAR},t_title=#{t_title},t_intro=#{t_intro},t_detail=#{t_detail},t_place=#{t_place},t_open_date=sysdate,t_date=#{t_date,jdbcType = VARCHAR},t_size=#{t_size},t_fname=#{t_fname,jdbcType = VARCHAR} where t_num=#{t_num}
	</update>
	
	<delete id="deleteTogether" parameterType="int">
		delete from together where t_num =#{t_num}
	</delete>
	
</mapper>