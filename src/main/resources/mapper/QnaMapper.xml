<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  	<!-- namespace는 dao interface의 경로 -->
<mapper namespace="com.example.demo.dao.QnaDao">


	<!-- id는 dao의 클래스 이름과 일치시켜야함 -->
	<!-- resultType은 vo의 경로 -->
  <select id="listQna" resultType="com.example.demo.vo.QnaVo">
    select * from qna order by inq_no
  </select>
  
  
  <insert id="insertQna">
  	insert into qna values (seq_inq_no.nextval,#{cs_no},#{inq_title},#{inq_content},sysdate,#{user_id},#{inq_file},0,0,0)
  </insert>
  
  <delete id="deleteQna">
  	delete qna where inq_no=#{inq_no} and user_id = #{user_id}
  </delete>
  
  <select id="detailQna" resultType="com.example.demo.vo.QnaVo">
  	select * from qna where inq_no=#{inq_no} and user_id = #{user_id}
  </select>
  
  <select id="getQnAListCount" parameterType="com.example.demo.vo.QnaVo" resultType="java.lang.Integer">
    SELECT COUNT(*)  FROM qna WHERE 1=1  /*조회 조건(검색어 키값)*/
        <if test="searchFiled != null and searchFiled != ''">
             /*searchFiled = 조회조건, searchValue = 검색어*/
            AND ${searchFiled} LIKE '%' || #{searchValue} || '%'
        </if>
	</select>
	
	<select id="getQnAList" parameterType="com.example.demo.vo.QnaVo" resultType="com.example.demo.vo.QnaVo">
    SELECT 
        a.inq_no, a.cs_no, a.inq_title, a.inq_content, a.inq_date, a.user_id, a.inq_file
    FROM (
        SELECT ROWNUM rnum, s.*
        FROM (
            SELECT inq_no, cs_no, inq_title, inq_content, inq_date, user_id, inq_file
            FROM qna
            WHERE 1=1 /*조회 조건(검색어 키값)*/
            <if test="searchFiled != null and searchFiled != ''">
                /*searchFiled = 조회조건, searchValue = 검색어*/
                AND ${searchFiled} LIKE '%' || #{searchValue} || '%'
            </if>
            ORDER BY inq_no DESC
        )s
    )a 
WHERE rnum BETWEEN #{startRowNo} AND #{endRowNo}
</select>

<select id="totalrecord" resultType="java.lang.Integer">
  	select count(*) from qna
  </select>
</mapper>